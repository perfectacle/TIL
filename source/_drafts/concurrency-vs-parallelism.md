---
title: 동시성 vs 병렬
tags: [Concurrency, Parallelism]
---

## 동시성이 등장하기 전에...  
MS DOS를 생각해보면 파일 업로드가 끝나야 다른 파일을 다운로드 받을 수 있다.  
즉 한 번에 한 가지의 일 밖에 하지 못한 것이다.  
만약 파일을 업로드하는데는 30초가 걸리고, 파일을 다운로드 하는데는 2초가 걸린다고 가정  
1. 30초 동안 파일 업로드에 대한 작업을 cpu가 수행 (수행시간: 30초, 파일 업로드: 완료, 파일 다운로드: 2초 남음)
1. 2초 동안 파일 업로드에 대한 작업을 cpu가 수행 (수행시간: 32초 + @(컨텍스트 스위칭 비용), 파일 업로드: 완료, 파일 다운로드: 완료)

총 소요된 시간은 32초 + @(컨텍스트 스위칭 비용까지 포함했을 때)이다.  
하지만 유저는 두 작업이 동시에 이뤄지지 않기 때문에 좋은 사용자 경험을 하지 못한다.  
이는 파일을 다운로드 받으면서 채팅을 할 수 없는 그런 문제로도 이어지기 때문이다.  

## 동시성
동시라고 느끼는, 동시는 아닌...  
쓰레드의 개념이 등장하면서 생긴 걸로 알고 있다.  
파일을 업로드하면서(A 쓰레드에서 수행) 동시에 다른 파일을 다운로드 받을 때(B 쓰레드에서 수행) 유저가 체감하지 못할 정도로 두 작업을 번갈아가면서 수행  

만약 파일을 업로드하는데는 30초가 걸리고, 파일을 다운로드 하는데는 2초가 걸린다고 가정  
파일 업로드가 시간이 더 많이 걸리므로 파일 업로드를 하는데 더 많은 수행 시간을 할당했다고 가정!    

1. 5초 동안 파일 업로드에 대한 작업을 cpu가 수행 (수행시간: 5초, 파일 업로드: 25초 남음, 파일 다운로드: 2초 남음)  
1. 1초 동안 파일 다운로드에 대한 작업을 cpu가 수행 (수행시간: 6초 + @(컨텍스트 스위칭 비용), 파일 업로드: 25초 남음, 파일 다운로드: 1초 남음) 
1. 다시 5초 동안 파일 업로드에 대한 작업을 cpu가 수행 (수행시간: 11초 + @+@(컨텍스트 스위칭 비용), 파일 다운로드: 1초 남음) 
1. 다시 1초 동안 파일 다운로드에 대한 작업을 cpu가 수행 (수행시간: 12초 + @+@+@(컨텍스트 스위칭 비용), 파일 업로드: 20초 남음, 파일 다운로드: 완료)
1. 뒤에 남은 작업이 없으므로 남은 20초 동안 파일 업로드에 대한 작업을 cpu가 수행 (수행시간: 32초 + @+@+@+@(컨텍스트 스위칭 비용), 파일 업로드: 완료, 파일 다운로드: 완료)
 
총 소요된 시간은 32초 + @+@+@+@(컨텍스트 스위칭 비용까지 포함했을 때...)  
동시성이 없을 때보다 컨텍스트 스위칭이 자주 발생해서 성능이 더 안좋아진 건지는 잘 모르겠다. (아마 안 좋아졌더라도 유저가 체감하기 힘든 수준이 아닐까...)  
즉 동시에 일어난 건 아니지만 유저가 느끼지 못할 시간으로 실행 시간을 쪼개서 마치 동시인 것처럼 느끼게 하는 것...  
하지만 두 작업이 유저 입장에서는 동시에 수행된 것처럼 느껴지므로 더 좋은 사용자 경험을 제공할 수 있다.  
하지만 위와 같이 파일 업로드에 유저가 느낄 만큼의 시간을 할당하면 반대로 파일 다운로드 작업은 멈춰져있는 것처럼 보여서 사용자에게 동시성 경험을 제대로 제공해주지 못한다.  
그렇다고 파일 업로드의 수행 시간을 좁히면 동시성은 느끼겠지만 반대로 컨텍스트 스위칭에 많은 비용이 들어갈 것이다.    

## 병렬
진짜 레알 동시에 실행하는 것.  
채팅을 하면서 파일을 다운로드 받는데 진짜로 두 작업이 별개로 실행됨.  
1. CPU A에서는 파일 다운로드에 대한 작업 수행 (30초)  
1. CPU B에서는 파일 다운로드에 대한 작업 수행 (2초) 

총 소요시간은 30초, 컨텍스트 스위칭도 일어나지 않음.  
진짜로 두 작업이 동시에 일어나는 것임.  
물론 동시성보다 성능도 뛰어날테지만 CPU도 좋은 걸 써야함. (진짜 CPU를 두 개 달거나(달 수나 있나??), 아니면 듀얼 코어 이상을 사용하거나...)  
이렇게 되니 동시성의 장점인 사용자 경험도 제공해주고, 동시성의 단점인 컨텍스트 스위칭 비용도 해결할 수 있다.  

## 병렬이 빛을 발할 때
별도의 작업(프로세스)를 수행할 때 (동시성이 없을 때 파일 업로드(30초), 파일 다운로드(2초)를 수행할 때)  
1. 동시성이 없을 때 - 32초 + @(컨텍스트 스위칭 비용까지 포함했을 때), 동시에 여러 작업이 수행된다는 느낌을 받지 못함.  
1. 동시성이 있을 때 - 32초 + @+@+@+@(컨텍스트 스위칭 비용까지 포함했을 ), 동시에 여러 작업이 수행된다는 느낌을 받지만 컨텍스트 스위칭이 잦다는 단점이 존재  
1. 병렬 - 30초, 동시에 여러 작업이 수행된다는 느낌도 주고 컨텍스트 스위칭도 없음.

실행 순서와 무관한 하나의 작업을 수행할 때  
**1~100까지 더하는 하나의 작업**을 **1~50까지 더하는 작업(15초 소요)**, **51~100까지 더하는 작업(30초 소요)**으로 쪼갰을 때  
1. 동시성이 없을 때 - 쪼갤 것도 없으므로 45초 (쪼개면 오히려 컨텍스트 스위칭 발생)  
1. 동시성이 있을 때 - 쪼갤 것도 없으므로 45초 (쪼개면 오히려 컨텍스트 스위칭 발생), 동시성이 없는 것과 동일하다.
1. 병렬 - 30초, CPU가 더 많다면 더 여러 작업으로 쪼개서 수행 시간을 더 줄일 수 있음.

## 병렬이 독이 될 때
실행 순서와 관련있는 하나의 작업을 수행할 때  
**2~5까지 곱하는 하나의 작업**을 **2x3의 연산을 수행하는 작업 A(3초 소요)**, **4x5의 연산을 수행하는 작업 B(4초 소요)** 